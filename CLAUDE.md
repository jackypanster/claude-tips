# CLAUDE.md（全局）

## 范围
本文件会被注入到每一次会话中：必须保持简短、通用。
不要把它当作风格细则或任务说明的“垃圾桶”。

## 通用原则
- 选择最简单且正确的方案，尽量少代码、少依赖、少抽象。
- 先用确定性证据，再下结论；不要用推测替代验证。
- 避免过早抽象，优先遵循仓库既有模式与约定。
- 小步快跑、可审查的改动；不确定就停下来提问。

## 工具策略（Unix 哲学）
- 优先使用“当前环境可用的命令行工具”做观察与验证（快、确定、成本低），包括：
  - 系统命令、已安装的 CLI、项目内脚本/二进制（例如 bin/、scripts/、Make/Task/Just 等）。
- 先只读摸底，再最小改动，再验证闭环。
- 优先复用项目提供的统一入口（Make/Task/包管理脚本等），保持流程一致与可复现。
- 仅当本地 CLI + 项目工具无法触达所需系统/数据，或无法稳定复现结果时，才引入 Skills/MCP。
- 不要让大模型做 linter/formatter 的工作；使用确定性工具并修复其输出的问题。

## 知识库
~/workspace/notes 是跨机器同步的个人知识库（~376 篇，技术/金融）。涉及技术方案、配置、架构决策时，动手前快速 grep 或 `mcp__qmd__search` 检索相关笔记，避免重复造轮子。

## 错误处理（Fast-Fail）
- 不要吞异常。
- 若必须捕获异常：补充可行动的上下文信息后再抛出。
  上下文应包含：位置（文件/函数）、输入、明确原因（不要模糊表述）。

## 测试与验证
- 默认优先真实集成路径；禁止新增 mock/stub（详见 agent_docs/tests.md）。
- 改动后运行最快的相关校验（测试/类型检查/lint/构建）。

## 默认工作流
1) 澄清意图与验收标准（简短）。
2) 给出最小计划（小步）。
3) 实现最小可用改动。
4) 用工具验证；修复失败；保持 diff 紧凑。
5) 总结改了什么、如何验证通过。

## 沟通与输出
- 用英文思考，用中文回复。
- 如被阻塞：说明已尝试什么、关键错误片段、下一步建议。

## 渐进披露
如果仓库存在 agent_docs/，按需阅读相关文档。
