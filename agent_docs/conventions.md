# agent_docs/conventions.md

## 目的
存放项目编码约定与“偏风格”的规则，避免污染 CLAUDE.md。
原则：优先遵循仓库既有模式；能用工具约束的，不用文字约束。

## 约定层级（从高到低）
1) 仓库现有代码风格与模式（最优先）
2) 自动化工具的输出（formatter/linter/typechecker）
3) 本文的约定（用于补足空白与减少争议）

## 代码组织与抽象
- 默认选择函数/模块化；类与抽象只在确有收益时引入。
- 避免“为了复用而复用”的抽象；重复 2~3 次后再评估抽象价值。
- 保持调用链可读：优先直接明了的实现而非层层封装。

## 命名与可读性
- 命名要表达业务含义与单位/范围；避免单字母或含糊缩写。
- 复杂逻辑优先写清楚，再考虑“优雅”。

## 错误与日志
- 不要吞异常；捕获必须补充上下文后再抛出。
- 错误信息要“可行动”：位置、输入、原因、下一步建议（如适用）。
- 日志策略遵循项目现状：若已有结构化日志/追踪体系，优先沿用，不另起炉灶。

## 性能与资源
- 优先正确性与可验证性；性能优化基于证据（profile/指标），避免拍脑袋。
- 大任务分步执行，控制并行度与资源峰值（详见 debugging.md 的“资源压力”）。

## 测试约定（与 tests.md 一致）
- 默认真实集成路径；必要时 mock/stub 并说明原因、缩小范围。
- 测试用例命名要描述场景与期望行为。

## 提交与变更控制
- 小提交、可回滚、便于 code review。
- 每次改动包含：变更点说明 + 最小验证证据（命令与输出片段）。

## 反模式（仅列高风险项）
- 不要引入“无意义封装/薄封装”，除非它显著降低复杂度或隔离风险。
- 不要在没有证据时进行大规模重构。
- 不要把格式/风格检查交给模型“目测”；交给工具。
