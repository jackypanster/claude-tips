# agent_docs/tools.md

## 目的
沉淀“当前环境可用 CLI 工具优先”的工作方式与套路。
这里强调：用工具建立事实，再让模型做推理与改动。

## 核心定义：什么是“可用 CLI 工具”
- 系统命令（基础 Unix 工具集）
- 已安装的第三方 CLI（例如 ripgrep、jq、fd、bat、fzf、gh、terraform 等）
- 项目内工具与脚本（例如 `bin/`、`scripts/`、`tools/`、`make/task/just` 入口等）

判断工具是否可用：
- `command -v <tool>` / `which <tool>`（只读检查）

## 总原则：先观察后行动
- 先用只读命令确定“现状是什么”
- 再做最小改动
- 再用工具验证“改动是否生效、是否引入回归”

## 常用套路（按问题类型）
### 代码定位与搜索（只读优先）
- 先用版本控制缩小范围：`git status` / `git diff` / `git log`
- 再用仓库内搜索优先：`git grep`
- 需要更强搜索能力时，用环境中可用的搜索工具（如 `rg`/`grep` 等）
- 文件发现：`find` 或更快的替代工具（如 `fd`，若可用）
- 最后用管道组合：`|` + `xargs`

建议：优先“限定范围”的工具（例如 `git grep`），减少误命中与噪音。

### 变更与审查
- 看改动面：`git diff`
- 看历史原因：`git blame` / `git show`（谨慎使用，避免过度归因）
- 看分支状态：`git status`

### 日志与运行时观察（按可用工具选择）
- 进程：`ps` / `top`（或更友好的替代工具若已安装）
- 端口：用环境可用的端口查看工具（如 `lsof`/`ss`/`netstat` 之一）
- 文件尾随：`tail -f`
- 系统日志：用环境可用的日志查看工具（如 `journalctl` 或其他）

### 文件系统与空间
- 目录大小：`du`
- 磁盘：`df -h`
- 权限：`ls -l` / `stat`

### 网络与依赖可达性（只读优先）
- HTTP 探测：`curl -I` / `curl -v`
- DNS/连通性：按环境工具选择（如 `ping`、`nslookup` 等）

## 跨发行版差异的处理原则（不枚举差异清单）
- 不假设某个参数一定存在；脚本中避免依赖“实现细节”。
- 若项目脚本依赖某工具的特定行为，请在脚本与文档显式写明。
- 以 CI/生产环境中实际使用的工具行为为权威。

## 安全护栏（避免事故）
- 任何可能破坏数据的操作（删除/覆盖/批量替换）必须先：
  1) 在最小范围试运行
  2) 用 `git diff` 或备份确认影响面
  3) 确认路径与变量展开无误（尤其包含空格、通配符时）
- 不在不确定时执行不可逆命令；不确定就停下来问。

## 建议的输出习惯（给 Agent 的操作提示）
当需要“看一眼现状”时，优先输出：
- 关键命令与关键输出片段（不要贴全量）
- 相关文件路径与行号
- 结论与下一步动作（最小化）
